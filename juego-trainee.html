<link rel="import" href="/bower_components/polymer/polymer-element.html">
<link rel="import" href="/bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="/bower_components/polymer/lib/elements/dom-if.html">
<link rel="import" href="/utils-styles.html">
<link rel="import" href="/juego-trainee-figura.html">
<link rel="import" href="/juego-trainee-modal.html">


<dom-module id="juego-trainee">
  <template>
    <style>
      :host {
        display: block;
        position: relative;
        font-family: sans-serif;
        background-color: black;
        padding: 2rem;
        overflow: hidden;
      }

      juego-trainee-modal.ganador,
      juego-trainee-modal.perdedor {
        --color-text-header: white;
      }

      juego-trainee-modal.ganador {
        --color-background-header: #4CAF50;
      }

      juego-trainee-modal.perdedor {
        --color-background-header: #D32F2F;
      }

      juego-trainee-figura[esta-seleccionada] {
        /* --figura-color-perdedor: var(--color-perdedor); */
        --figura-color-perdedor: #D32F2F;
      }

      juego-trainee-figura[esta-seleccionada][es-ganador] {
        /* --figura-color-ganador: var(--color-ganador); */
        --figura-color-ganador: #4CAF50;
      }


      .icono-gato,
      .icono-perro {
        position: absolute;
        top: 0;
        font-size: 3rem;
      }

      .icono-gato {
        right: 0;
        transform: rotate(30deg) scale(1.2);
      }

      .icono-perro {
        left: 0;
        transform: rotate(-30deg) scale(1.2);
      }

      .instrucciones {
        color: white;
      }

      .instrucciones>*:not(h2) {
        display: block;
        margin-bottom: 1rem;
      }

      .instrucciones>.txt-titulo {
        font-size: 1.6rem;
        text-align: center;
        margin: .1rem 0 1rem 0;
      }

      .instrucciones>.txt-instrucciones {
        font-size: 1.4rem;
      }

      .instrucciones>.txt-descripcion {
        font-size: 1.2rem;
      }
    </style>
    <span class="icono-perro">🐶</span>
    <span class="icono-gato">🐱</span>
    <div class="instrucciones">
      <h2 class="txt-titulo">El juego del gato</h2>
      <label class="txt-instrucciones">Instrucciones:</label>
      <span class="txt-descripcion"> Hay un gato escondido dentro de alguna de estas figuras, encuéntralo y gana,
        ¡pero cuidado con los perros, ya que tambien están escondidos entre las figuras buscando al gato!</span>
    </div>
    <template is="dom-repeat" items="{{figuras}}" as="figura">
      <juego-trainee-figura class="m-1" on-seleccion="obtenerSeleccion" es-ganador="{{figura.esGanador}}"
        esta-seleccionada="{{figura.estaSeleccionada}}"></juego-trainee-figura>
    </template>
    <juego-trainee-modal class$="{{datosModal.estatus}}" titulo="{{datosModal.titulo}}" mensaje="{{datosModal.mensaje}}"
      mostrar="{{datosModal.mostrar}}">
    </juego-trainee-modal>

  </template>

  <script>
    class JuegoTrainee extends Polymer.Element {
      static get is() {
        return 'juego-trainee';
      }
      static get properties() {
        return {
          datosModal: {
            type: Object,
            value: {
              titulo: '',
              mensaje: '',
              mostrar: false,
              estatus: 'defecto'
            }
          },
          figuras: {
            type: Array,
            value: []
          },
          intentos: {
            type: Number,
            value: 3
          }
        };
      }

      ready() {
        super.ready();
        this.set('figuras', this.crearFiguras(10));
      }

      crearFiguras(cantidad) {
        let numerosSinRepetir = [];
        while (numerosSinRepetir.length < cantidad) {
          let numeroAleatorio = Math.floor((Math.random() * cantidad) + 1);
          if (!numerosSinRepetir.find((n) => n === numeroAleatorio)) {
            numerosSinRepetir.push(numeroAleatorio);
          }
        }
        return numerosSinRepetir.map((n) => ({
          esGanador: n === 1 ? true : false,
          estaSeleccionada: false
        }));
      }

      obtenerSeleccion(e) {
        if (e.detail.esGanador) {
          this.mostrarModal('¡GANASTE!', '¡Has encontrado al gato!', 'ganador');
        } else {
          this.restarIntentos();
          if (this.get('intentos') === 0) {
            this.mostrarModal('PERDISTE...', 'Se han acabado tus intentos...', 'perdedor');
          }
        }
      }

      restarIntentos() {
        let intentos = this.get('intentos');
        this.set('intentos', --intentos);
      }

      mostrarModal(titulo, mensaje, estatus) {
        this.set('datosModal.titulo', titulo);
        this.set('datosModal.mensaje', mensaje);
        this.set('datosModal.mostrar', true);
        this.set('datosModal.estatus', estatus);
      }

    }

    window.customElements.define(JuegoTrainee.is, JuegoTrainee);
  </script>
</dom-module>