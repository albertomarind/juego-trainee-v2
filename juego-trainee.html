<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../polymer/lib/elements/dom-if.html">
<link rel="import" href="../paper-dialog/paper-dialog.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-slider/paper-slider.html">
<link rel="import" href="../paper-input/paper-input.html">

<link rel="import" href="utils-styles.html">
<link rel="import" href="juego-trainee-core.html">


<dom-module id="juego-trainee">
  <template>
    <style include="utils-styles">
      :host {
        display: block;
        position: relative;
        font-family: sans-serif;
        background-color: black;
        padding: 2rem;
        overflow: hidden;
      }

      paper-button {
        font-family: 'Roboto', 'Noto', sans-serif;
        font-weight: normal;
        font-size: 14px;
        -webkit-font-smoothing: antialiased;
      }

      paper-button.indigo {
        background-color: var(--paper-indigo-500);
        color: white;

        --paper-button-raised-keyboard-focus: {
          background-color: var(--paper-pink-a200);
          color: white;
        }

        ;
      }

      paper-button.indigo:hover {
        background-color: var(--paper-indigo-400);
      }

      paper-dialog.ganador h2,
      paper-dialog.perdedor h2 {
        margin: 0;
        padding: .5rem;
        color: white;
        text-align: center;
      }

      paper-dialog.ganador h2 {
        background-color: var(--color-ganador);
      }

      paper-dialog.perdedor h2 {
        background-color: var(--color-perdedor);
      }

      paper-slider {
        margin-top: 0;

        --paper-slider-input: {
          display: inline-block;
          width: 100px;
        }

        ;
      }

      .icono-gato,
      .icono-perro {
        position: absolute;
        top: 0;
        font-size: 3rem;
      }

      .icono-gato {
        right: 0;
        transform: rotate(30deg) scale(1.2);
      }

      .icono-perro {
        left: 0;
        transform: rotate(-30deg) scale(1.2);
      }

      .instrucciones {
        color: white;
      }

      .instrucciones>*:not(h1) {
        display: block;
        margin-bottom: 1rem;
      }

      .instrucciones>.txt-titulo {
        font-size: 1.6rem;
        text-align: center;
        margin: .1rem 0 1rem 0;
      }

      .instrucciones>.txt-instrucciones {
        font-size: 1.4rem;
      }

      .instrucciones>.txt-descripcion {
        font-size: 1.2rem;
      }

      .lbl-figuras {
        margin-top: 25px;
        display: inline-block;
        font-size: .8rem;
        font-weight: 300;
      }
    </style>
    <paper-dialog id="modalInicio" modal>
      <paper-input required auto-validate error-message="Ingresa el nombre por favor" always-float-label
        label="Nombre: " id="nombre"></paper-input>
      <label class="lbl-figuras">Cantidad de figuras:</label>
      <paper-slider id="cantidadFiguras" min="1" max="100" value="5" editable></paper-slider>
      <div class="buttons">
        <paper-button on-click="validarDatosUsuario" class="indigo">Aceptar</paper-button>
      </div>
    </paper-dialog>
    <template is="dom-if" if="[[mostrarJuego]]">

      <span class="icono-perro">üê∂</span>
      <span class="icono-gato">üê±</span>
      <div class="instrucciones">
        <h1 class="txt-titulo">El juego del gato</h1>
        <h2 class="txt-usuario">Usuario: {{nombreUsuario}}</h2>
        <label class="txt-instrucciones">Instrucciones: </label>
        <span class="txt-descripcion"> Hay un gato escondido dentro de alguna de estas figuras, encu√©ntralo y gana,
          ¬°pero cuidado con los perros, ya que tambien est√°n escondidos entre las figuras buscando al gato!</span>
      </div>

      <juego-trainee-core id="core" cantidad="{{cantidadFiguras}}" on-ganador="mostrarModalGanador"
        on-perdedor="mostrarModalPerdedor">
      </juego-trainee-core>

      <paper-dialog id="modalReinicio" modal class$="{{datosModal.estatus}}">
        <h2> {{datosModal.titulo}}</h2>
        <span class="d-block"> {{datosModal.mensaje}}</span>
        <div class="buttons">
          <paper-button dialog-confirm on-click="reiniciar">Reiniciar</paper-button>
        </div>
      </paper-dialog>
    </template>

  </template>

  <script>
    class JuegoTrainee extends Polymer.Element {
      static get is() {
        return 'juego-trainee';
      }
      static get properties() {
        return {
          cantidadFiguras: {
            type: Number,
            value: 5
          },
          datosModal: {
            type: Object,
            value: {
              titulo: '',
              mensaje: '',
              estatus: 'defecto'
            }
          },
          nombreUsuario: {
            type: String
          },
          mostrarJuego: {
            type: Boolean,
            value: false
          }
        };
      }

      abrirDialog() {
        this.$.modalInicio.open();
      }

      ready() {
        super.ready();
        this.abrirDialog();
      }

      validarDatosUsuario() {
        if (this.shadowRoot.getElementById('nombre').validate()) {
          this.set('nombreUsuario', this.$.nombre.value);
          this.set('cantidadFiguras', parseInt(this.$.cantidadFiguras.value));
          this.set('mostrarJuego', true)
          this.$.modalInicio.close();
        }
      }

      reiniciar() {
        this.set('cantidadFiguras', this.cantidadFiguras);
        this.shadowRoot.querySelector('#core').iniciar();
      }

      mostrarModalGanador() {
        this.mostrarModal('¬°GANASTE!', '¬°Has encontrado al gato!', 'ganador');
      }
      mostrarModalPerdedor() {
        this.mostrarModal('PERDISTE...', 'Se han acabado tus intentos...', 'perdedor');
      }

      mostrarModal(titulo, mensaje, estatus) {
        this.set('datosModal.titulo', titulo);
        this.set('datosModal.mensaje', mensaje);
        this.set('datosModal.estatus', estatus);
        this.shadowRoot.querySelector('#modalReinicio').open();
      }
    }

    window.customElements.define(JuegoTrainee.is, JuegoTrainee);
  </script>
</dom-module>